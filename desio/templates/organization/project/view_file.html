<%inherit file="base.html"/>
<%namespace name="r" file="/require.html"/>
<%namespace name="f" file="/forms.html"/>
<%!
    import simplejson as json
%>
<%def name="header()">
    ${parent.header()}
    ${r.require('file', 'image')}
    <style type="text/css">
    
    #tabs{
        height: 30px;
    }
    #tabs .tab{
        width: 36px; height: 30px; background: #f3f3f3;
        float: right;
        margin-left: 3px;
        color: #666;
        font-weight: bold;
        line-height: 34px;
        text-align: center;
        font-size: 9pt;
        cursor: pointer;
    }
    #tabs .tab.selected{
        color: #f0f0f0;
        background: #ccc;
    }
    
    /*****/
    .image-viewer .top-bar{
        height: 35px;
        background: #333;
        color: #fff;
    }
    .image-viewer .top-bar .next-button{float: right; color: #fff}
    .image-viewer .top-bar .previous-button{float: left; color: #fff}
    
    .image-viewer .top-bar .text{text-align: center; font-weight: bold; line-height: 35px;}
    
    .image-viewer .image{
        background: #fff;
        border: 1px solid #ccc;
        padding: 15px 0;
        /*width: 960px;*/
        text-align: center;
    }
    .image-viewer .image img{
        max-width: 800px
    }
    
    /****/
    .image .jcrop-holder{
        margin: 0 auto;
    }
    .image{position: relative;}
    
    /****/
    .new-image-comment{
        width: 294px;
        position: absolute;
        z-index: 1000;
    }
    .new-image-comment .comment-container{
        width: 250px;
        background: #eee;
        border: 2px solid #ccc;
        padding: 20px;
    }
    .new-image-comment p{margin-top: 0;}
    .new-image-comment textarea{width: 240px;}
    
    /****/
    .popup-comment-view{
        width: 350px;
        position: absolute;
        z-index: 1000;
    }
    .popup-comment-view .comment-container{
        background: #eee;
        border: 2px solid #ccc;
    }
    
    /**comments**/
    
    #comments>.comment{border-bottom: 1px solid #ccc;}
    #comments .comment.selected{background: #fff;}
    .comment{padding: 8px 10px;}
    .replies .comment{padding-right: 0;}
    
    .comment .time{
        float: right;
        font-weight: bold;
        color: #666;
        font-size: 9pt;
        line-height: 25px;
        height: 25px;
    }
    .comment .creator{ line-height: 25px; height: 25px; }
    .comment .creator>span{font-weight: bold;}
    .comment.position{cursor: pointer;}
    .comment.position .creator{
        padding-left: 24px;
        background: transparent url(${h.static_url('i', 'icons/selection.png')}) 0 3px no-repeat;
    }
    .comment .body{margin-top: 5px;}
    .comment .replies{padding-left: 10px;}
    
    #reply-comment{display:none;}
    
    /***pins****/
    
    .pins .pin{position: absolute; width: 37px; height: 37px; z-index: 1001;}
    
    </style>
    
    <script type="text/javascript">
    new Q.ViewFilePage({
        url: '${h.api_url('file', 'upload', project=c.project.eid)}',
        versions: ${json.dumps(c.file_dict) | n},
        comments: ${json.dumps(c.comments['comments']) | n},
        path: '${c.path}',
        boxWidth: 800,
        showDropTargetOn: 'elemdrag'//'bodydrag'
    }).readyrun();
    </script>
</%def>

<%def name="sidepanel()">
    % if c.file.description:
        <p id="description">${c.file.description}</p>
    % endif
    <ul id="file-links">
        <li><a href="#">Download</a></li>
        <li><a href="#">Share this file</a></li>
    </ul>
    
    <h3>Comments</h3>
    
    <div id="comments">
        
    </div>
    
    <div><a id="add-comment-link" href="#">add a comment</a></div>
    <div id="add-comment">
        <form method="post">
            <p>Enter your comment</p>
            <div>${f.textarea('body', id=None)}</div>
            ${f.submit('Add Comment')} <a href="#" class="cancel">cancel</a>
        </form>
    </div>
    
    <div id="reply-comment">
        <form method="post">
            <p>Craft your reply</p>
            <div>${f.textarea('body', id=None)}</div>
            ${f.submit('Add Reply')} <a href="#" class="cancel">cancel</a>
        </form>
    </div>
</%def>

<div id="tabs"></div>

<div id="inpage-image-viewer">
    <div class="image-viewer">
        <div class="image-container">
            
        </div>
    </div>
</div>

<script id="tab-template" class="jstemplate" type="text/template">
    <span class="tab-text">v{{version}}</span>
</script>

<script id="image-template" class="jstemplate" type="text/template">
    <img src="{{url}}" />
    <div class="pins"></div>
</script>

<script id="pin-template" class="jstemplate" type="text/template">
    <img class="pin not-doc" src="${h.static_url('i', 'icons/blob.png')}" title="{{title}}" />
</script>

<script id="image-comment-template" class="jstemplate" type="text/template">
    <div class="comment-container">
        <form method="post">
            <p>Enter a comment</p>
            <div>${f.textarea('body', id=None)}</div>
            ${f.submit('Add Comment')}
        </form>
    </div>
</script>

<script id="popup-comment-template" class="jstemplate" type="text/template">
    <div class="comment-container">
    </div>
</script>

<script id="comment-template" class="jstemplate" type="text/template">
    <div class="time">{{time}} (v{{version}})</div>
    <div class="creator"><span>{{creator}}</span></div>
    <div class="body">{{body}}</div>
    <div class="replies"></div>
    <div><a href="#" class="reply-link">reply</a></div>
</script>

<div class="clear"></div>

