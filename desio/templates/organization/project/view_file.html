<%inherit file="base.html"/>
<%namespace name="r" file="/require.html"/>
<%namespace name="f" file="/forms.html"/>
<%!
    import simplejson as json
    from desio import utils
%>
<%def name="header()">
    ${parent.header()}
    ${r.require('file', 'image')}
    <style type="text/css">
    
    </style>
    
    <script type="text/javascript">
    new Q.ViewFilePage({
        url: '${h.api_url('file', 'upload', project=c.project.eid)}',
        versions: ${json.dumps(c.file_dict) | n},
        comments: ${json.dumps(c.comments['comments']) | n},
        path: '${c.path}',
        boxWidth: 800,
        fullBoxWidth: 800+310,
        collapsePreference: 'view_file_sidepanel_collapse',
        collapseInitially: ${c.real_user.get_preference('view_file_sidepanel_collapse', default='false')},
        showDropTargetOn: 'elemdrag'//'bodydrag'
    }).readyrun();
    </script>
</%def>

<%def name="sidepanel()">
    <div class="info">
        % if c.file.description:
            <p id="description">${c.file.description}</p>
        % endif
        <ul>
            <li><a href="#" class="action icon-download">Download</a></li>
            <li><a href="#" class="action icon-share">Share this file</a></li>
        </ul>
    </div>
    
    <h3 id="comments-header">Notes for version <span class="version">${c.head_change.version}</span></h3>
    
    <div id="comments-view">
        <div id="comments-filter">
            <a href="#" class="selected" rel="all" title="Show all notes">All</a>
            <a href="#" rel="open" title="Show only open (uncompleted) notes">Open</a>
            <a href="#" rel="completed" title="Show only completed notes">Completed</a>
        </div>
        
        <div id="comments">
            
        </div>
        
        <div class="no-comments no-comments-all">
            This version of ${c.file.name} has no notes.
            Add one by dragging a box on the image and typing your comment.
        </div>
        <div class="no-comments no-comments-open">
            There are no open, uncompleted notes to show for this version.
            This is probably a good thing!
        </div>
        <div class="no-comments no-comments-completed">
            There are no completed notes to show for this version.
        </div>
    </div>
    
    ##<div><a id="add-comment-link" href="#">add a comment</a></div>
    <div id="add-comment">
        <form method="post">
            <p>Enter your comment</p>
            <div>${f.textarea('body', id=None)}</div>
            ${f.submit('Add Comment')} <a href="#" class="cancel">cancel</a>
        </form>
    </div>
    
    <div id="reply-comment">
        <form method="post">
            <div>${f.textarea('body', id=None)}</div>
            <div class="buttons">
                ${f.submit('Add Reply', className="primary b114 bleft")} <a href="#" class="cancel secondary b79 bleft">Cancel</a>
            </div>
        </form>
    </div>
</%def>

<%def name="content_subheader()">
    <div id="version-tabs" class="tabs"></div>
    <div class="file-meta">
        <b>v<span class="version">${c.head_change.version}</span></b> by
        <span class="name">${c.head_change.creator.human_name}</span>
        <span class="time">${utils.relative_date_str(c.head_change.created_date)}</span>
    </div>
</%def>

<div id="toolbar">
    <a href="#" id="sidepanel-collapse"></a>
    <a id="pin-toggle" class="selected" href="#" title="Click to hide annotation pins."></a>
</div>

<div id="inpage-image-viewer">
    <div class="image-viewer">
        <div class="image-container">
            
        </div>
    </div>
</div>

<script id="tab-template" class="jstemplate" type="text/template">
    <span class="tab-text {{comments_class}}">
        <span class="number-comments {{comments_class}}">{{number_comments_open}}</span>
        <span class="text">v{{version}}</span>
    </span>
</script>

<script id="image-template" class="jstemplate" type="text/template">
    <img src="{{url}}" />
    <div class="pins"></div>
</script>

<script id="pin-template" class="jstemplate" type="text/template">
    <div class="pin not-doc status-{{completion_status}}" title="{{title}}"></div>
</script>

<script id="image-comment-template" class="jstemplate" type="text/template">
    <div class="popup-container comment-container">
        <form method="post">
            <h4>Enter a Note</h4>
            <div>${f.textarea('body', id=None)}</div>
            <div class="buttons">
                ${f.submit('Add Note', className="primary b114 bleft")} <a href="#" class="cancel secondary b79 bleft">Cancel</a>
            </div>
        </form>
    </div>
</script>

<script id="popup-comment-template" class="jstemplate" type="text/template">
    <div class="popup-container comment-container">
    </div>
</script>

<script id="comment-template" class="jstemplate" type="text/template">
    <div class="number-comments">0</div>
    <a href="#" class="pin-small complete-indicator status-{{completion_status}}" title="Click to mark this note complete"></a>
    <div class="creator">
        <span>{{creator}}</span> says
    </div>
    <div class="body">{{body}}</div>
    <div class="time">{{time}}</div>
    <div class="replies"></div>
    <div class="reply-box">
        <input type="text" class="text" value="Add a reply..."/>
    </div>
</script>

<div class="clear"></div>

