<%inherit file="base.html"/>
<%namespace name="r" file="/require.html"/>
<%namespace name="project" file="/modules/project.html"/>

<%!
    from desio import utils
    from desio.model import STATUS_APPROVED
%>
<%def name="js_includes()">
    ${parent.js_includes()}
    ${r.require('file', 'controllers.organization.project')}
</%def>

<%def name="header()">
    ${parent.header()}
    <style type="text/css">
        .project .files{
            height: 208px;
        }
        #projects .project h2 a{
            color: #333;
        }
        #projects .project h2{
            margin: 0 0 10px 0;
        }
        #projects .project{
            margin-bottom: 20px;
        }
    </style>
    
    <script type="text/javascript">
        new Q.OrgHomePage({}).readyrun();
    </script>
</%def>

<%def name="content_header()">
    All Projects
</%def>

<%
    users = [uc.user_id for uc in c.organization.get_user_connections(status=STATUS_APPROVED) if uc.user_id != c.organization.creator_id]
%>

% if c.is_org_admin and not users:
    <p>
        It's looking pretty lonely in here.
        You should <a href="${h.url_for(controller='organization/settings', action='users')}">invite some folks</a>.
    </p>
% endif

% if c.project_data:
    <% pfiles = [f for p, f in c.project_data if f] %>
    % if not pfiles:
        % if c.is_org_creator:
        <p>
            We haven't found any activity in any of your projects yet. You should head over to
            <a href="${h.url_for(controller='organization/project', action='view', slug=c.projects[0].slug)}">
                one of your projects
            </a>
            and drag some design files in there.
        </p>
        % else:
        <p>
            No activity in this organization yet.
        </p>
        % endif
    % endif
    
    <div id="projects">
    % for p, files in c.project_data:
        % if files:
            <div class="project">
                <h2><a href="${h.url_for(controller='organization/project', action='view', slug=p.slug)}">${p.name}</a></h2>
                <div class="files">
                % for i, f in enumerate(files):
                    <% ch = f.get_change() %>
                    <div class="file ${i%3 == 0 and 'posmod3' or ''} ${i%4 == 0 and 'posmod4' or ''}">
                        ${project.file_thumb(p, f.name, ch.version, f.full_path, ch.base_url+ch.thumbnail_url, ch.creator.human_name, utils.relative_date_str(ch.created_date), utils.file_size(ch.size), ch.number_comments)}
                    </div>
                % endfor
                </div>
            </div>
        % endif
    % endfor
    </div>
% else:
    <p>
        No projects yet.
        % if c.is_org_creator:
            <a href="${h.url_for(controller='organization/project', action='new')}">Make one</a>
        % endif
    </p>
% endif

<div class="clear"></div>